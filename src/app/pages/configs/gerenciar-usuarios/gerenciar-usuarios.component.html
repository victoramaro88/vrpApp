<h1>Gerenciar Usuários</h1>
<p-blockUI [blocked]="boolLoading">
  <p-progressSpinner [style]="{width: '50px', height: '50px'}" styleClass="custom-spinner" strokeWidth="8" fill="#EEEEEE" animationDuration=".5s"></p-progressSpinner>
</p-blockUI>
<p-toast  position="top-center"></p-toast>

<div *ngIf="!editarUsuario">
  <p-table
  [value]="listaUsuarios"
  styleClass="p-datatable-gridlines p-datatable-striped"
  >
    <ng-template pTemplate="header">
        <tr>
            <th style="text-align: center;">Nome</th>
            <th style="text-align: center;">CPF</th>
            <th style="text-align: center;">Perfil</th>
            <th style="text-align: center;">Status</th>
            <th style="text-align: center;">Ações</th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-item>
        <tr>
            <td style="text-align: center;">{{item.nomeUsuario}}</td>
            <td style="text-align: center;">{{item.cpfUsuario}}</td>
            <td style="text-align: center;">{{listaPerfil[item.idPerfil - 1].descPerfil}}</td>
            <td style="text-align: center;">{{item.statusUsuario ? 'Ativo' : 'Inativo'}}</td>
            <td style="text-align: center;">
              <i class="pi pi-user-edit cursorMouse" title="Editar" style="color: rgb(13, 72, 210);" (click)="SelecionarUsuario(item.idUsuario);"></i>
              &nbsp;<i [ngClass]="item.statusUsuario == true ? 'pi pi-times' : 'pi pi-check'"
              class="cursorMouse"
              title="{{item.statusUsuario ? 'Inativar' : 'Ativar'}}"
              style="color: rgb(13, 72, 210);" (click)="AlteraStatusUsuario(item.idUsuario, !item.statusUsuario);"></i>
            </td>
        </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
          <td style="text-align: center;" colspan="5">Sem informações a serem exibidas.</td>
      </tr>
  </ng-template>
  </p-table>
</div>

<div *ngIf="editarUsuario">

  <div class="card">
    <div class="formgrid grid">
        <div class="field col-12 md:col-6 sm:col-4">
            <label for="nome">Nome</label>
            <input [(ngModel)]="objUsr.nomeUsuario" id="nome" type="text" class="inputfield w-full" pInputText />
        </div>
        <div class="field col-12 md:col-3 sm:col-4">
            <label for="cpf">CPF</label>
            <input [disabled]="boolLoading" [(ngModel)]="objUsr.cpfUsuario" id="cpf" type="text" class="inputfield w-full" [dropSpecialCharacters]="false" mask="CPF_CNPJ" pInputText />
        </div>
        <div class="field col-6 md:col-3 sm:col-4 text-center">
            <label for="status">Status</label>
            <p-selectButton [disabled]="boolLoading" id="status"  [options]="[{label: 'Inativo', value: false}, {label: 'Ativo', value: true}]" [(ngModel)]="objUsr.statusUsuario" optionLabel="label" optionValue="value"></p-selectButton>
        </div>
        <div class="field col-6 md:col-2 sm:col-4">
          <label for="perfil">Perfil</label><br>
          <p-dropdown [disabled]="boolLoading" id="perfil" [options]="listaPerfil" [(ngModel)]="perfilSelecionado" placeholder="Selecione" optionLabel="descPerfil"></p-dropdown>
        </div>
        <div class="field col-12 md:col-8 sm:col-12 text-center">
          <br>
          <button [disabled]="boolLoading" *ngIf="!alterarSenha" (click)="alterarSenha=true" pButton pRipple type="button" label="Alterar Senha" class="p-button-raised p-button-warning"></button>
          <div *ngIf="alterarSenha" class="grid text-center">
            <div class="field col-12 sm:col-5 text-center">
              <label for="senha">Nova senha</label><br>
              <p-password [ngClass]="{'border-orange-500 border-3': senhaNaoConfere}" [(ngModel)]="senha" (change)="ValidaSenhas();" id="senha" [toggleMask]="true"></p-password>
            </div>
            <div class="field col-12 sm:col-5 text-center">
              <label for="novaSenha">Repita a senha</label><br>
              <p-password [ngClass]="{'border-orange-500 border-3': senhaNaoConfere}" id="novaSenha" (change)="ValidaSenhas();" [(ngModel)]="objUsr.senhaUsuario" [feedback]="false" [toggleMask]="true"></p-password>
              <br><b><small *ngIf="senhaNaoConfere" id="novaSenha-help" class="p-error">{{mensagemSenha}}</small></b>
            </div>
            <div class="field col-12 sm:col-2 pt-4">
              <button [disabled]="boolLoading" (click)="CancelaAlterarSenha();" pButton pRipple type="button" label="Cancelar" class="p-button-raised p-button-danger"></button>
            </div>
          </div>
        </div>
    </div>
  </div>

  <hr>

  <div class="text-right">
    <button [disabled]="boolLoading" (click)="CancelaAlterarUsuario();" routerLinkActive="router-link-active"  pButton icon="pi pi-times" type="button" class="p-button-raised p-button-danger" label="Cancelar" styleClass="p-mr-2"></button>
    &nbsp;<p-button [disabled]="boolLoading" (click)="Salvar()" class="p-button-raised" icon="pi pi-check" label="Salvar" styleClass="p-mr-2"></p-button>
  </div>
</div>

<p-confirmDialog [breakpoints]="{'960px': '75vw', '640px': '100vw'}" [style]="{width: '50vw'}" [baseZIndex]="10000" rejectButtonStyleClass="p-button-text"></p-confirmDialog>

